<div class="edit-form-container">
  <dx-form class="plain-styled-form"   [(visible)]="popupVisible">
    <dxi-item itemType="tabbed">
      <dxi-tab title="General">
        <dxi-item itemType="group" [colCount]="3">
          <dxi-item
            itemType="group"
            [colCount]="1"
            [colSpan]="2"
            class="spacing-item"
          >
          <!-- <dxo-scrolling mode="standard"></dxo-scrolling> -->
            <dxi-item itemType="group" [colCount]="2">
              <dxi-item class="spacing-item">
                <div *dxTemplate>
                  <dx-text-box label="Item Code" [labelMode]="'floating'" [(value)]="itemData.ITEM_CODE" >
                    <dx-validator>
                      <dxi-validation-rule
                        type="required"
                        message="This field is required"
                      ></dxi-validation-rule>
                    </dx-validator>
                  </dx-text-box>
                </div>
              </dxi-item>
  
              <dxi-item class="spacing-item">
                <div *dxTemplate>
                  <dx-text-box label="Bar Code" [labelMode]="'floating'" [(value)]="itemData.BARCODE">
                    <dx-validator>
                      <dxi-validation-rule
                        type="required"
                        message="This field is required"
                      ></dxi-validation-rule>
                    </dx-validator>
                  </dx-text-box>
                </div>
              </dxi-item>
            </dxi-item>
            <dxi-item itemType="group" [colCount]="2" class="spacing-item">




                               <dxi-item class="spacing-item">
              <div *dxTemplate>
                <dx-text-box
                  label="Metrics"
                  [(value)]="itemData.MATRIX_CODE"
                  [labelMode]="'floating'"
                       [visible]="ENABLE_Matrix_Code"
                ></dx-text-box>
              </div>
            </dxi-item>
            
               <dxi-item >
                <div *dxTemplate>
                  <dx-select-box
                   class="spacing-item"
                    label="Item Type"
                    displayExpr="DESCRIPTION"
                    [items]="itemtype"
                    valueExpr="ID"
                    [labelMode]="'floating'"
                    placeholder="Select Item Type"
                     [searchEnabled]="true"
                    [(value)]="itemData.TYPE_ID"
 [width]="'100%'"
                    (onValueChanged)="onTypeIdChange($event)"
                  >
                    <dx-validator>
                      <dxi-validation-rule
                        type="required"
                        message="This field is required"
                      ></dxi-validation-rule> </dx-validator
                  ></dx-select-box>
                </div>
              </dxi-item>
</dxi-item>
           
            <dxi-item itemType="group" [colCount]="1">
              <dxi-item class="spacing-item">
                <div *dxTemplate>
                  <dx-text-box
                    label="Description"
                    [(value)]="itemData.DESCRIPTION"
                    [labelMode]="'floating'"
                  >
                    <dx-validator>
                      <dxi-validation-rule
                        type="required"
                        message="This field is required"
                      ></dxi-validation-rule>
                    </dx-validator>
                  </dx-text-box>
                </div>
              </dxi-item>
            </dxi-item>
   <dxi-item itemType="group" [colCount]="2" class="spacing-item">
            <dxi-item class="spacing-item">
              <div *dxTemplate>
                <dx-text-box
                  label="POS Description"
                  [(value)]="itemData.POS_DESCRIPTION"
                  [labelMode]="'floating'"
                ></dx-text-box>
              </div>
            </dxi-item>
  
            <dxi-item class="spacing-items">
              <div *dxTemplate>
                <dx-text-box
                  label="Arabic Description"
                  [(value)]="itemData.ARABIC_DESCRIPTION"
                  [labelMode]="'floating'"
                >
                  <dx-validator>
                    <dxi-validation-rule
                      type="required"
                      message="This field is required"
                    ></dxi-validation-rule>
                  </dx-validator>
                </dx-text-box>
              </div>
            </dxi-item>
 
  
           
            </dxi-item>
  
            <dxi-item itemType="group" [colCount]="2">
              <dxi-item class="spacing-item">
                <div *dxTemplate>
                  <dx-select-box
                    label="Department"
                    displayExpr="DESCRIPTION"
                    [items]="department"
                    [labelMode]="'floating'"
                    valueExpr="ID"
                    placeholder="Select Department"
                    [searchEnabled]="true"
                    [(value)]="itemData.DEPT_ID"
                  ></dx-select-box>
                </div>
              </dxi-item>
              <dxi-item class="spacing-item">
                <div *dxTemplate>
                  <dx-select-box
                    label="Brand"
                    [items]="brand"
                    displayExpr="DESCRIPTION"
                    valueExpr="ID"
                    placeholder="Select Brand"
                    [searchEnabled]="true"
                    [(value)]="itemData.BRAND_ID"
                    [labelMode]="'floating'"
                  >
                  </dx-select-box>
                </div>
              </dxi-item>
              
            </dxi-item>
            <dxi-item itemType="group" [colCount]="2" class="spacing-item">
            </dxi-item>
            <dxi-item itemType="group" [colCount]="2" class="spacing-item">
              <dxi-item>
                <div *dxTemplate>
                  <dx-select-box
                    label="Category"
                    [items]="catagory"
                    displayExpr="DESCRIPTION"
                    valueExpr="ID"
                     [searchEnabled]="true"
                    placeholder="Select Category"
                    [labelMode]="'floating'"
                    [(value)]="itemData.CAT_ID"
                  >
                    <dx-validator>
                      <dxi-validation-rule
                        type="required"
                        message="This field is required"
                      ></dxi-validation-rule> </dx-validator
                  ></dx-select-box>
                </div>
              </dxi-item> 
              <dxi-item itemType="group" [colCount]="3">
                <div *dxTemplate>
                  <dx-select-box
                    label="Item Tax"
                     [searchEnabled]="true"
                    [items]="vat"
                    displayExpr="VAT_NAME"
                    valueExpr="ID"
                    placeholder="Select Tax"
                    [labelMode]="'floating'"
                    [(value)]="itemData.VAT_CLASS_ID"
                  >
                    <dx-validator>
                      <dxi-validation-rule
                        type="required"
                        message="This field is required"
                      ></dxi-validation-rule>
                    </dx-validator>
                  </dx-select-box>
                </div>
              </dxi-item>
             
            </dxi-item>
            <dxi-item itemType="group" [colCount]="2" class="spacing-item">
            </dxi-item>
            <dxi-item itemType="group" [colCount]="2" class="spacing-item">
              <dxi-item>
                <div *dxTemplate>
                  <dx-select-box
                    label="Sub Category"
                    [items]="subcatagory"
                    displayExpr="SUBCAT_NAME"
                    valueExpr="ID"
                    placeholder="Select Sub Category"
                    [searchEnabled]="true"
                    [labelMode]="'floating'"
                    [(value)]="itemData.SUBCAT_ID"
                  >
                    <dx-validator>
                      <dxi-validation-rule
                        type="required"
                        message="This field is required"
                      ></dxi-validation-rule> </dx-validator
                  ></dx-select-box>
                </div>
              </dxi-item>
              <dxi-item class="spacing-item">
                <div *dxTemplate>
                  <dx-select-box
                    label="Unit of Measure"
                    [items]="uom"
                    displayExpr="DESCRIPTION"
                    valueExpr="ID"
                    placeholder="Select Unit"
                    [labelMode]="'floating'"
                 [searchEnabled]="true"
                    [(value)]="itemData.UNIT_ID"
                    (onValueChanged)="onUOMChange($event)"
                  >
                    <dx-validator>
                      <dxi-validation-rule
                        type="required"
                        message="This field is required"
                      ></dxi-validation-rule>
                    </dx-validator>
                  </dx-select-box>
                </div>
              </dxi-item>
              
            </dxi-item>
            <dxi-item itemType="group" [colCount]="3" class="spacing-item">
            
            <!-- <dxi-item itemType="group" [colCount]="2"> -->
              <dxi-item class="spacing-item">
                <div *dxTemplate>
                  <dx-check-box
                    [(value)]="itemData.IS_DIFFERENT_UOM_PURCH"
                    text="Is Different UOM"
                    [width]="150"
                    [labelMode]="'floating'"
                    class="custom-checkbox"
                  >
                  </dx-check-box>
                </div>
              </dxi-item>
              <dxi-item *ngIf="itemData.IS_DIFFERENT_UOM_PURCH">
                <dx-select-box
                  label="Option"
                  [(value)]="selectedData"
                  [items]="filteredUOMs"
                  displayExpr="DESCRIPTION"
                  valueExpr="DESCRIPTION"
                  [labelMode]="'floating'"
                  placeholder="Choose an option"
               [searchEnabled]="true"
          
                >
                </dx-select-box>
              </dxi-item>
  
              <dxi-item *ngIf="itemData.IS_DIFFERENT_UOM_PURCH">
                <dx-text-box
                  label="Conversion Quantity"
                  [(value)]="itemData.UOM_MULTPLE"
                  placeholder="Conversion Quantity"
                  [width]="190"
                  labelMode="floating"
                  [disabled]="!itemData.IS_DIFFERENT_UOM_PURCH"
                >
                </dx-text-box>
              </dxi-item>
            </dxi-item>
            <dxi-item itemType="group" [colCount]="2" class="spacing-item">
            </dxi-item>
            <dxi-item itemType="group" [colCount]="1">
              <div *dxTemplate>
                <dx-text-box
                  label="Notes"
                  [(value)]="itemData.LONG_DESCRIPTION"
                  labelMode="floating"
                ></dx-text-box>
              </div>
            </dxi-item>
          </dxi-item>
          <dxi-item itemType="group" [colCount]="1">



            <dxi-item itemType="group" [colCount]="1">
              <dxi-item class="spacing-custom">
                <div class="widget-container flex-box">
                  <div
                    id="dropzone-external"
                    class="flex-box"
                    [ngClass]="isDropZoneActive ? 'dropzone-active' : null"
                    (click)="onDropZoneClick()"
                    style="
                      padding: 0;
                      margin: 0;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                    "
                  >
                    <img
                      id="dropzone-image"
                      [src]="imageSource"
                      *ngIf="imageSource"
                      alt=""
                      style="height: 100%; width: 100%; object-fit: cover"
                      (click)="openModal($event)"
                    />
                    <div id="dropzone-text" class="flex-box" *ngIf="textVisible">
                      <span>Upload Image</span>
                    </div>
                  </div>
                  <dx-file-uploader
                    #fileUploader
                    dialogTrigger="#dropzone-external"
                    dropZone="#dropzone-external"
                    [multiple]="false"
                    [allowedFileExtensions]="allowedFileExtensions"
                    uploadMode="instantly"
                    [visible]="false"
                  ></dx-file-uploader>
                  <input
                    type="file"
                    #fileInput
                    style="display: none"
                    (change)="onFileInputChange($event)"
                    labelMode="'floating'"
                  />
                  <div class="button-container" style="margin-top: 10px">
                    <dx-button
                      *ngIf="imageUploaded"
                      (click)="clearImage()"
                      class="clear-button-container"
                    >
                      <i class="fas fa-times"></i>
                    </dx-button>
                  </div>
                </div>
              </dxi-item>
              <div id="imageModal" class="modal" (click)="closeModal()">
                <span class="close" (click)="closeModal()">&times;</span>
                <img class="modal-content" id="modalImage" />
                <div id="caption"></div>
              </div>
            </dxi-item>


            <dxi-item itemType="group" [colCount]="2"> </dxi-item>
      
          <dxi-item >
            <div *dxTemplate>
              <dx-select-box
              class="field-spacing "
                label="{{ itemlabel1 }}"
                [items]="itemprop1"
                displayExpr="DESCRIPTION"
                valueExpr="ID"
                placeholder="Select {{ ITEM_PROPERTY1 }}"
                labelMode="floating"
                [(value)]="itemData.ITEM_PROPERTY1"
              style="width: 275px;margin-left: 45px;"
                 [searchEnabled]="true"
    [label]="ITEM_PROPERTY1 && ITEM_PROPERTY1 !== '' ? ITEM_PROPERTY1 : itemlabel1"
              >
              </dx-select-box>
            </div>
          </dxi-item>
          
          <dxi-item >
            <div *dxTemplate>
              <dx-select-box
              class="field-spacing"
                label="{{ itemlabel2 }}"
                [items]="itemprop2"
                displayExpr="DESCRIPTION"
                valueExpr="ID"
                             placeholder="Select {{ ITEM_PROPERTY2 }}"
                
    [label]="ITEM_PROPERTY2 && ITEM_PROPERTY2 !== '' ? ITEM_PROPERTY2 : itemlabel1"
                labelMode="floating"
                 [searchEnabled]="true"
                [(value)]="itemData.ITEM_PROPERTY2"
                  style="width: 275px;margin-left: 45px;"
              >
                <!-- <dx-validator>
                  <dxi-validation-rule
                    type="required"
                    message="This field is required"
                  ></dxi-validation-rule>
                </dx-validator> -->
              </dx-select-box>
            </div>
          </dxi-item>
          
          <dxi-item>
            <div *dxTemplate>
              <dx-select-box
               class="field-spacing"
                [searchEnabled]="true"
                label="{{ itemlabel3 }}"
                [items]="itemprop3"
                displayExpr="DESCRIPTION"
                valueExpr="ID"
                placeholder="Select {{ ITEM_PROPERTY3 }}"
                style="width: 275px;margin-left: 45px;"
    [label]="ITEM_PROPERTY3 && ITEM_PROPERTY3 !== '' ? ITEM_PROPERTY3 : itemlabel1"
                labelMode="floating"
                [(value)]="itemData.ITEM_PROPERTY3"
              >
                <!-- <dx-validator>
                  <dxi-validation-rule
                    type="required"
                    message="This field is required"
                  ></dxi-validation-rule>
                </dx-validator> -->
              </dx-select-box>
            </div>
          </dxi-item>
         
          <dxi-item >
            <div *dxTemplate>
              <dx-select-box
               [searchEnabled]="true"
               class="field-spacing"
               [visible]="ITEM_PROPERTY4 && ITEM_PROPERTY4 !== ''"
                label="{{ itemlabel4 }}"
                [items]="itemprop4"
                displayExpr="DESCRIPTION"
                valueExpr="ID"
                placeholder="Select {{ ITEM_PROPERTY4 }}"
                [label]="ITEM_PROPERTY4 && ITEM_PROPERTY4 !== '' ? ITEM_PROPERTY4 : itemlabel4"
                labelMode="floating"
                [(value)]="itemData.ITEM_PROPERTY4"
                  style="width: 275px;margin-left: 45px;"
              >
                <!-- <dx-validator>
                  <dxi-validation-rule
                    type="required"
                    message="This field is required"
                  ></dxi-validation-rule>
                </dx-validator> -->
              </dx-select-box>
            </div>
          </dxi-item>
        
          <dxi-item >
            <div *dxTemplate>
              <dx-select-box
               class="field-spacing"
                [searchEnabled]="true"
                label="{{ itemlabel5 }}"
                     [visible]="ITEM_PROPERTY5 && ITEM_PROPERTY5 !== ''"
                [items]="itemprop5"
                displayExpr="DESCRIPTION"
                valueExpr="ID"
                placeholder="Select {{ ITEM_PROPERTY5 }}"
                [label]="ITEM_PROPERTY5 && ITEM_PROPERTY5 !== '' ? ITEM_PROPERTY5 : itemlabel5"
                 style="width: 275px;margin-left: 45px;"
                labelMode="floating"
                [(value)]="itemData.ITEM_PROPERTY5"
              >
              </dx-select-box>
            </div>
          </dxi-item>
          </dxi-item>
  
        </dxi-item>
      </dxi-tab>
      <dxi-tab title="Alias">
        <dxi-item itemType="group" [colCount]="1">
          <dxi-item>
            <dx-data-grid
              class="grid theme-dependent"
              [columnAutoWidth]="true"
              [height]="'70vh'"
              [width]="'100%'"
              keyExpr="ALIAS"
              [showBorders]="true"
              [dataSource]="itemData.item_alias"
             [searchEnabled]="true"
            >
              <dxo-editing mode="row" [allowAdding]="true" [allowDeleting]="true">
              </dxo-editing>
              <dxo-scrolling mode="standard"></dxo-scrolling>
              <!-- <dxo-selection mode="multiple"> </dxo-selection> -->
              <dxi-column dataField="ALIAS" caption="Code">
                <dxi-validation-rule type="required"></dxi-validation-rule>
              </dxi-column>
            </dx-data-grid>
          </dxi-item>
        </dxi-item>
      </dxi-tab>
  
      <dxi-tab title="Pricing">
        <div class="container-wrapper">
          <!-- Left Container (Pricing Section) -->
          <div class="left-container">
            <dxi-item class="spacing-custom">
              <div class="price-header">Pricing</div>
            </dxi-item>
            <dxi-item itemType="group" [colCount]="2">
              <div class="form-container">
               
                <div class="inventory-item">
                  <label>Price:</label>
                  
                  <dx-number-box [(value)]="itemData.SALE_PRICE"  (onValueChanged)="onPriceChange($event)"   [format]="{ type: 'fixedPoint', precision: 2 }" [labelMode]="'floating'" [width]="200"></dx-number-box>
                </div>
                <div class="inventory-item">
                  <label>Cost:</label>
                  <dx-number-box   [format]="{ type: 'fixedPoint', precision: 2 }" [(value)]="itemData.COST"  [labelMode]="'floating'" [width]="200"></dx-number-box>
                </div>
                <div class="inventory-item">
                  <label>Profit Margin:</label>
                  <dx-number-box [value]="calculateProfitMargin()"   (onValueChanged)="onProfitmarginChange($event)"     [labelMode]="'floating'"    [format]="{ type: 'fixedPoint', precision: 2 }" [width]="200"></dx-number-box>
                </div>
             
                <div class="inventory-item">
                  <label>Price Level 1:</label>
                  <dx-number-box [(value)]="itemData.SALE_PRICE1"  (onValueChanged)="onSalesPrice1Change($event)" (onValueChanged)="onSalesPrice1Change($event)"     [labelMode]="'floating'"   [format]="{ type: 'fixedPoint', precision: 2 }" [width]="200"></dx-number-box>
                </div>
                <div class="inventory-item">
                  <label>Price Level 2:</label>
                  <dx-number-box [(value)]="itemData.SALE_PRICE2"  (onValueChanged)="onSalesPrice2Change($event)"  [format]="{ type: 'fixedPoint', precision: 2 }"  [labelMode]="'floating'" [width]="200"></dx-number-box>
                </div>
                <div class="inventory-item">
                  <label>Price Level 3:</label>
                  <dx-number-box [(value)]="itemData.SALE_PRICE3"   (onValueChanged)="onSalesPrice3Change($event)" [format]="{ type: 'fixedPoint', precision: 2 }" [labelMode]="'floating'" [width]="200"></dx-number-box>
                </div>
                <div class="inventory-item">
                  <label>Price Level 4:</label>
                  <dx-number-box [(value)]="itemData.SALE_PRICE4"  (onValueChanged)="onSalesPrice4Change($event)"  [format]="{ type: 'fixedPoint', precision: 2 }"  [labelMode]="'floating'" [width]="200"></dx-number-box>
                </div>
                <div class="inventory-item">
                  <label>Price Level 5:</label>
                  <dx-number-box [(value)]="itemData.SALE_PRICE5" (onValueChanged)="onSalesPrice5Change($event)"   [format]="{ type: 'fixedPoint', precision: 2 }" [labelMode]="'floating'" [width]="200"></dx-number-box>
                </div>
                <div class="inventory-item">
                  <label>Costing Method:</label>
                    <dx-select-box
                    [items]="costingMethodOptions"
                    displayExpr="DESCRIPTION"
                    valueExpr="ID"
                     [searchEnabled]="true"
                    placeholder="Select Costing Method"
                    [(value)]="itemData.COSTING_METHOD"
                    [labelMode]="'floating'"
                    >
                    </dx-select-box>
                  </div>
                     <div class="inventory-item">
                  <label>Last Purchase Price:</label>
                  <dx-number-box [(value)]="itemData.PURCH_PRICE"  [format]="{ type: 'fixedPoint', precision: 2 }" [readOnly]="true" [labelMode]="'floating'" [width]="200"></dx-number-box>
                </div>
              </div>
            </dxi-item>
          </div>
  
          <!-- Right Containers (Inventory and History) -->
          <div class="right-containers">
            <!-- Inventory Container -->
            <div class="inventory-container">
              <div class="price-header">Inventory</div>
              <dxi-item itemType="group" [colCount]="2">
             
                <div class="inventory-item">
                  <label>On Hand Quantity:</label>
                  <dx-text-box [value]="itemData.QTY_STOCK" [width]="200" [labelMode]="'floating'" [readOnly]="true"></dx-text-box>
                </div>
               
                <div class="inventory-item">
                  <label>Committed Quantity:</label>
                  <dx-text-box [value]="itemData.QTY_COMMITTED"  [labelMode]="'floating'" [width]="200" [readOnly]="true"></dx-text-box>
                </div>
                
                <div class="inventory-item">
                  <label>Available Quantity:</label>
                  <dx-text-box [value]="itemData.QTY_STOCK"  [labelMode]="'floating'" [width]="200" [readOnly]="true"></dx-text-box>
                </div>
                <div class="inventory-item">
                  <label>Restock Level:</label>
                  <dx-text-box [(value)]="itemData.RESTOCK_LEVEL"  [labelMode]="'floating'" [width]="200" ></dx-text-box>
                </div>
                <div class="inventory-item">
                  <label>Reorder Quantity:</label>
                  <dx-text-box [(value)]="itemData.REORDER_POINT"  [labelMode]="'floating'" [width]="200" ></dx-text-box>
                </div>
                
              </dxi-item>
            </div>
  
            <!-- History Container -->
            <div class="history-container">
              <div class="price-header">History</div>
              <div class="inventory-item">
                <label>Date Created:</label>
                <dx-date-box [value]="itemData.CREATED_DATE"  displayFormat="dd/MM/yyyy"  [labelMode]="'floating'" [width]="200" [readOnly]="true"></dx-date-box>
              </div>
              <div class="inventory-item">
                <label>Last Ordered:</label>
                <dx-date-box [value]="itemData.LAST_PO_DATE"  displayFormat="dd/MM/yyyy" [labelMode]="'floating'"  [width]="200" [readOnly]="true"></dx-date-box>
              </div>
              <div class="inventory-item">
                <label>Last Received:</label>
                <dx-date-box [value]="itemData.LAST_GRN_DATE"  displayFormat="dd/MM/yyyy" [labelMode]="'floating'" [width]="200" [readOnly]="true"></dx-date-box>
              </div>
              <div class="inventory-item">
                <label>Last Sold:</label>
                <dx-date-box [value]="itemData.LAST_SALE_DATE"  displayFormat="dd/MM/yyyy" [labelMode]="'floating'" [width]="200" [readOnly]="true"></dx-date-box>
              </div>
            </div>
          </div>
        </div>
      </dxi-tab>
    
      <dxi-tab title="Stores">
        <dxi-item>
          <dx-data-grid
            class="grid theme-dependent always-show-scrollbar"
            [dataSource]="Edit_Store"
            displayExpr="store"
            [columnAutoWidth]="true"
            [height]="'70vh'"
            width="100%"
            keyExpr="STORE_ID"
            [showBorders]="true" 
            [(selectedRowKeys)]="selectedRowKeys" 
            (onSelectionChanged)="onSelectionChanged($event)"
            
          >
            <dxo-scrolling mode="standard" showScrollbar="always"></dxo-scrolling>
            <dxo-selection mode="multiple"> </dxo-selection>
            <dxo-editing mode="cell" [allowUpdating]="true"></dxo-editing>
            <dxi-column dataField="STORE_NAME" caption="Store Name"></dxi-column>
            <dxi-column dataField="SALE_PRICE" caption="Price"></dxi-column>
            
            <dxi-column
              dataField="SALE_PRICE1"
              caption="Price Level 1"
            ></dxi-column>
            <dxi-column
              dataField="SALE_PRICE2"
              caption="Price Level 2"
            ></dxi-column>
            <dxi-column
              dataField="SALE_PRICE3"
              caption="Price Level 3"
            ></dxi-column>
            <dxi-column
              dataField="SALE_PRICE4"
              caption="Price Level 4"
            ></dxi-column>
            <dxi-column
              dataField="SALE_PRICE5"
              caption="Price Level 5"
            ></dxi-column>
            <dxi-column
              dataField="LAST_MODIFIED_DATE"
              caption="Added Date"
              format="dd/MM/yyyy"
               dataType="date"
               
            ></dxi-column>
            <dxi-column
              dataField="QTY_AVAILABLE"
              caption="Available Quantity"
            ></dxi-column>
            <dxi-column
              dataField="IS_INACTIVE"
              caption="Is Inactive"
              dataType="boolean"
              [editorOptions]="{ enableTwoStateBehavior: true }"
            >
            </dxi-column>
            <dxi-column
              dataField="IS_NOT_SALE_ITEM"
              caption="Not a Sale Item"
              dataType="boolean"
              [editorOptions]="{ enableTwoStateBehavior: true }"
            >
            </dxi-column>
            <dxi-column>
              <dx-check-box
                text="Price On Transaction "
                [(value)]="itemData.IS_PRICE_REQUIRED"
              ></dx-check-box>
            </dxi-column>
  
            <dxi-column
              dataField="IS_PRICE_REQUIRED"
              caption="Price Required"
              dataType="boolean"
              [editorOptions]="{ enableTwoStateBehavior: true }"
            ></dxi-column>
            <dxi-column
              dataField="IS_NOT_DISCOUNTABLE"
              caption="Not Discountable"
              dataType="boolean"
              [editorOptions]="{ enableTwoStateBehavior: true }"
            ></dxi-column>
            <dxi-column
              [visible]="false"
              valueExpr="ID"
              dataField="ID"
              [editorOptions]="{ enableTwoStateBehavior: true }"
            ></dxi-column>
          </dx-data-grid>
        </dxi-item>
      </dxi-tab>
   
      <dxi-tab title="Special">
        <dxi-item itemType="group" [colSpan]="2">
          <div class="container">
            <!-- Special Container -->
            <div class="special-container">
              <dxi-item itemType="group" [colCount]="2">
                <dxi-item>

                  <dx-drop-down-box
                  labelMode="floating"
                  labelLocation="left"
                  label="Select Parent Item"
                  valueExpr="ID"
                  [(value)]="itemData.PARENT_ITEM_ID"
                  displayExpr="DESCRIPTION"
                  [showClearButton]="true"
                  [dataSource]="parentitem"
                >
      
                  <div *dxTemplate="let data of 'content'">
                    <div *ngIf="isLoading" class="loading-container">
                      <div *ngIf="isLoading" class="loading-spinner-container">
                        <div class="spinner"></div>
                      </div>
                    </div>
                    <dx-data-grid
                    *ngIf="!isLoading"
                      [dataSource]="parentitem"
                     
                      [columns]="[{ dataField: 'DESCRIPTION', caption: 'Description' }]"
                      [selection]="{ mode: 'single' }"
                      [hoverStateEnabled]="true"
                      [paging]="{ enabled: true, pageSize: 10 }"
                      [filterRow]="{ visible: true }"
                      [headerFilter]="{ visible: true }"
                      [scrolling]="{ mode: 'virtual' }"
                      [height]="'50vh'"
                      (onSelectionChanged)="onParentItemChanged($event)"
                    >
      
      
                    </dx-data-grid>
                  </div>
                </dx-drop-down-box>
                  <!-- <dx-select-box
                  class="mb-3"
                    label="Parent Item"
                    displayExpr="DESCRIPTION"
                    [items]="parentitem"
                    valueExpr="ID"
                    placeholder="Select Parent Item"
                    [searchEnabled]="true"
                   
                    [(value)]="itemData.PARENT_ITEM_ID"
                  ></dx-select-box> -->
                </dxi-item>
              </dxi-item>
              <dxi-item itemType="group" [colCount]="1" class="spacing-custom-items">
                <dxi-item class="spacing-custom-items">
                  <dx-text-box
                    label="Child Quantity"
                    [width]="140"
                    [disabled]="!isParentItemSelected"
                    [(value)]="itemData.CHILD_QTY"
                    labelMode="floating"
                  ></dx-text-box>
                </dxi-item>
              </dxi-item>
              <dxi-item itemType="group" [colCount]="2" class="spacing-custom-items">
                <dxi-item class="spacing-custom-items">
                  <dx-select-box
                    label="Country of Origin"
                    id="custom-templates"
                    displayExpr="COUNTRY_NAME"
                    valueExpr="ID"
                    [dataSource]="countries"
                    [inputAttr]="{ 'aria-label': 'Country' }"
                    [(value)]="itemData.ORIGIN_COUNTRY"
                    [searchEnabled]="true"
                    placeholder="Select Country"
                    labelMode="floating"
                  >
                    <div *dxTemplate="let data of 'field'">
                      <div class="custom-item">
                        <img
                          alt="{{ data.country }}"
                          [src]="data.flag_url"
                          width="20"
                          height="20"
                          style="margin-right: 8px"
                        />
                        <dx-text-box
                          class="country-name"
                          [value]="data && data.country"
                          [inputAttr]="{ 'aria-label': 'Country' }"
                          labelMode="floating"
                          [readOnly]="true"
                        ></dx-text-box>
                      </div>
                    </div>
                    <div *dxTemplate="let data of 'item'">
                      <div class="custom-item">
                        <img
                          alt="{{ data.COUNTRY_NAME }}"
                          [src]="data.FLAG_URL"
                          width="20"
                          height="20"
                          style="margin-right: 8px"
                        />{{ data.COUNTRY_NAME }}
                      </div>
                    </div>
                  </dx-select-box>
                </dxi-item>
              </dxi-item>
              <dxi-item itemType="group" [colCount]="2" class="spacing-custom-items">
                <dxi-item class="spacing-custom-items">
                  <dx-text-box
                    label="Bin Location"
                    [(value)]="itemData.BIN_LOCATION"
                    labelMode="floating"
                  ></dx-text-box>
                </dxi-item>
              </dxi-item>
              <dxi-item itemType="group" [colCount]="2" class="spacing-custom-items">
                <dxi-item class="spacing-custom-items">
                  <dx-text-box
                    label="Shelf Life"
                    [(value)]="itemData.SHELF_LIFE"
                    labelMode="floating"
                    [width]="150"
                  ></dx-text-box>
                </dxi-item>
              </dxi-item>
              <dxi-item itemType="group" [colCount]="2" class="spacing-custom-items">
                <dxi-item class="spacing-custom-items">
                  <dx-text-area
                    label="Notes"
                    [(value)]="itemData.NOTES"
                    labelMode="floating"
                  ></dx-text-area>
                </dxi-item>
              </dxi-item>
            </div>
      
            <!-- Options Container -->
            <div class="options-container">
              <dxi-item >
                <div class="price-header">Options</div>
              </dxi-item>
              <dxi-item>
                <dx-check-box 
                  text="Inactive"
                  [(value)]="itemData.IS_INACTIVE"
                  labelMode="floating"
                  style="margin-top: 20px;"
                ></dx-check-box>
              </dxi-item>
              <dxi-item >
                <dx-check-box 
                  text="Price On Transaction"
                  [(value)]="itemData.IS_PRICE_REQUIRED"
                ></dx-check-box>
              </dxi-item>
              <dxi-item>
                <dx-check-box 
                  text="Not Discountable"
                  [(value)]="itemData.IS_NOT_DISCOUNTABLE"
                ></dx-check-box>
              </dxi-item>
              <dxi-item>
                <dx-check-box 
                  text="Not Placed On PO"
                  [(value)]="itemData.IS_NOT_PURCH_ITEM"
                ></dx-check-box>
              </dxi-item>
              <dxi-item>
                <dx-check-box 
                  text="Not Available for Sale"
                  [(value)]="itemData.IS_NOT_SALE_ITEM"
                ></dx-check-box>
              </dxi-item>
              <dxi-item>
                <dx-check-box 
                  text="Consignment Items"
                  [(value)]="itemData.IS_CONSIGNMENT"
                ></dx-check-box>
              </dxi-item>
              <dxi-item>
                <dx-check-box 
                  text="Cannot be returned on Transaction"
                  [(value)]="itemData.IS_NOT_SALE_RETURN"
                ></dx-check-box>
              </dxi-item>
            </div>
          </div>
        </dxi-item>
      </dxi-tab>

      

  
      <dxi-tab title="Supplier" *ngIf="showSupplierTab" >
        <dxi-item>
     
          <dx-data-grid
  class="grid theme-dependent"
  [columnAutoWidth]="false"
  height="300"
  keyExpr="ID"
  [showBorders]="true"
  [dataSource]="edit_Suplier"
   (onRowUpdated)="onRowUpdated($event)"
   
  [editing]="{
    mode: 'cell',
    allowUpdating: true,
    allowDeleting: true,
    allowAdding: true,
    useIcons: true
  }"
>
  <dxo-scrolling mode="standard"></dxo-scrolling>

  <!-- Supplier Column -->
  <dxi-column dataField="SUPP_ID"  caption="Supplier Name"  >
    <dxo-lookup
      [dataSource]="supplier"
      displayExpr="SUPP_NAME"
      valueExpr="ID"
    ></dxo-lookup>
  </dxi-column>

  <!-- Currency (Read Only) -->
  <dxi-column
    dataField="CURRENCY"
    caption="Currency"
    [editorOptions]="{ readOnly: true }"
  >
  </dxi-column>

  <!-- Reorder Number -->
  <dxi-column
    dataField="REORDER_NO"
    caption="Reorder No"
    dataType="number"
  ></dxi-column>

  <!-- Cost -->
  <dxi-column dataField="COST" caption="Cost" dataType="number">
    <dxi-validation-rule type="required"></dxi-validation-rule>
  </dxi-column>

  <!-- Primary Checkbox -->
  <dxi-column
    dataField="IS_PRIMARY"
    dataType="boolean"
    caption="Primary"
    [editorOptions]="{ enableTwoStateBehavior: true }"
  ></dxi-column>

  <!-- Hidden Column -->
  <dxi-column dataField="IS_CONSIGNMENT" [visible]="false"></dxi-column>
</dx-data-grid>

        </dxi-item>
      </dxi-tab> 

      <dxi-tab *ngIf="showComponentTab" title="Component">
        <dx-data-grid [showBorders]="true" [columnAutoWidth]="true" [dataSource]="gridData">
          <dxi-column dataField="ITEM_CODE" caption="Item Code"></dxi-column>
          <dxi-column dataField="DESCRIPTION" caption="Description"></dxi-column>
          <dxi-column dataField="UOM" caption="UOM"></dxi-column>
          <dxi-column
            dataField="QUANTITY"
            caption="Quantity"
            [alignment]="'right'"
          ></dxi-column>


          <dxo-editing
          mode="popup"
     
          [allowDeleting]="true">
 
        </dxo-editing>
  
          <dxo-toolbar>
            <dxi-item location="after">
              <dx-button
                icon="add"
                hint="Add Items"
                stylingMode="contained"
                type="normal"
                [width]="40"
                (click)="addComponent()"
              >
              </dx-button>
            </dxi-item>
          </dxo-toolbar>
        </dx-data-grid>
      </dxi-tab>

    
    </dxi-item>


    
  </dx-form>
  
    <div
      class="form-popup-buttons-container"
    
    >
      <dx-button
        text="Cancel"
        stylingMode="outlined"
        type="normal"
        (onClick)="closeForm()"
      ></dx-button>
      <dx-button
        text="Save"
        stylingMode="contained"
        type="default"
        (onClick)="saveData()"
  
      ></dx-button>
    </div>
  </div>

  <dx-popup
  [(visible)]="isPopupVisible"
  [width]="'850'"
  [height]="'340px'"
  title="Select Items"
  [showCloseButton]="true"

>
  <div>
    <dx-form [formData]="formData">
      <dxi-item itemType="group" [colCount]="3">
        <div *dxTemplate>
          <dx-drop-down-box
            labelMode="floating"
            labelLocation="left"
            label="Select Item"
            valueExpr="ID"
            [(value)]="selectedItemId"
            displayExpr="displayValue"
            [showClearButton]="true"
            [dataSource]="newItemList"
          >

            <div *dxTemplate="let data of 'content'">
              <div *ngIf="isLoading" class="loading-container">
                <div *ngIf="isLoading" class="loading-spinner-container">
                  <div class="spinner"></div>
                </div>
              </div>
              <dx-data-grid
              *ngIf="!isLoading"
                [dataSource]="newItemList"
               
                [columns]="[
                  { dataField: 'ITEM_CODE', caption: 'Code' },
                  { dataField: 'DESCRIPTION', caption: 'Description' },
                  { dataField: 'UOM', caption: 'UOM', visible: false  },
  
                ]"
                [selection]="{ mode: 'single' }"
                [hoverStateEnabled]="true"
                [paging]="{ enabled: true, pageSize: 10 }"
                [filterRow]="{ visible: true }"
                [headerFilter]="{ visible: true }"
                [scrolling]="{ mode: 'virtual' }"
                [height]="'50vh'"
                (onSelectionChanged)="onItemSelected($event)"
              >


              </dx-data-grid>
            </div>
          </dx-drop-down-box>
        </div>
      </dxi-item>

      <dxi-item itemType="group" [colCount]="2">
        <dxi-item dataField="UOM" label="UOM"></dxi-item>
        <dxi-item dataField="QUANTITY" label="Quantity"></dxi-item>

      </dxi-item>
    </dx-form>
  </div>


  <div class="button-container1">
    <dx-button text="Save" type="default" (onClick)="saveItem()"></dx-button>
    <dx-button text="Cancel" type="normal" (onClick)="cancelPopup()"></dx-button>
  </div>


    <!-- <div
      class="form-popup-buttons-container"

    >
      <dx-button
        text="Cancel"
        stylingMode="outlined"
        type="normal"
        (onClick)="cancelPopup()"
      ></dx-button>
      <dx-button
        text="Save"
        stylingMode="contained"
        type="default"

        (onClick)="saveItem()"
      ></dx-button>
    </div> -->

</dx-popup>
