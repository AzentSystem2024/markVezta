<div
  class="invoice-wrapper"
  style="
    height: 70vh;
    display: flex;
    flex-direction: column;
    box-sizing: border-box;
  "
>
  <div class="salary-grid-wrapper" style="padding: 0 10px">
    <div class="grid-container">
      <dx-data-grid
        #itemsGridRef
        [dataSource]="noteDetails"
        [showBorders]="true"
        [showColumnLines]="true"
        [columnAutoWidth]="false"
        [wordWrapEnabled]="false"
        [rowAlternationEnabled]="true"
        [headerFilter]="{ visible: true }"
        [allowColumnReordering]="true"
        [showColumnHeaders]="true"
        [columnAutoWidth]="true"
        [allowColumnResizing]="true"
        [height]="'55vh'"
        [columnResizingMode]="'nextColumn'"
        [headerFilter]="{ visible: true }"
        [scrolling]="{ mode: 'virtual' }"
        rowAlternationInterval="2"
        [selection]="{ mode: 'single' }"
      >
        <dxo-load-panel [showPane]="false"></dxo-load-panel>
        <dxo-toolbar>
          <dxi-item location="before">
            <div style="display: flex; flex-direction: column; gap: 5px">
              <div style="display: flex; gap: 5px">
                <dx-select-box
                  #distributorRef
                  [dataSource]="distributorList"
                  [(value)]="selectedDistributorId"
                  displayExpr="DESCRIPTION"
                  valueExpr="ID"
                  [width]="405"
                  [searchEnabled]="true"
                  [showClearButton]="true"
                  label="Customer"
                  labelMode="floating"
                  [readOnly]="true"
                ></dx-select-box>
                <!--  -->
              </div>
              <div style="display: flex; align-items: baseline; gap: 5px">
                <dx-text-box
                  label="Doc No"
                  [value]="creditFormData?.[0]?.DOC_NO"
                  labelMode="floating"
                  [width]="200"
                  [readOnly]="true"
                ></dx-text-box>
                <dx-text-box
                  label="Invoice No."
                  [value]="creditFormData?.[0]?.INVOICE_NO"
                  labelMode="floating"
                  [width]="200"
                  [readOnly]="true"
                ></dx-text-box>
              </div>
            </div>
          </dxi-item>
          <dxi-item location="after">
            <div style="display: flex; flex-direction: column; gap: 5px">
              <div style="display: flex; justify-content: flex-end">
                <dx-date-box
                  label="Date"
                  labelMode="floating"
                  [width]="200"
                  [(value)]="transDate"
                  displayFormat="dd-MM-yyyy"
                  [readOnly]="true"
                ></dx-date-box>
              </div>
              <div style="display: flex; gap: 6px">
                <dx-number-box
                  label="Due Amount"
                  labelMode="floating"
                  [value]="creditFormData?.[0]?.DUE_AMOUNT"
                  [format]="{ type: 'fixedPoint', precision: 2 }"
                  [width]="200"
                  [showSpinButtons]="true"
                  [inputAttr]="{ style: 'text-align: right;' }"
                  [readOnly]="true"
                ></dx-number-box>
              </div>
            </div>
          </dxi-item>
        </dxo-toolbar>

        <dxi-column
          dataField="SL_NO"
          caption="Sl No"
          [allowEditing]="true"
          [readOnly]="true"
        ></dxi-column>

        <dxi-column
          dataField="ledgerCode"
          caption="Ledger Code"
          [editorType]="'dxSelectBox'"
          [lookup]="{
            dataSource: ledgerList,
            valueExpr: 'HeadCode',
            displayExpr: 'HeadCode',
            searchEnabled: true
          }"
        ></dxi-column>
        <dxi-column
          dataField="ledgerName"
          caption="Ledger Name"
          [width]="200"
          [editorType]="'dxSelectBox'"
          [lookup]="{
            dataSource: ledgerList,
            valueExpr: 'HeadName',
            displayExpr: 'HeadName',
            searchEnabled: true
          }"
        ></dxi-column>
        <dxi-column
          dataField="particulars"
          caption="Particulars"
          [width]="150"
          [editorOptions]="{ maxLength: 250 }"
        >
        </dxi-column>

        <dxi-column
          dataField="Amount"
          caption="Amount"
          dataType="number"
          [format]="{ type: 'fixedPoint', precision: 2 }"
          [width]="150"
        ></dxi-column>

        <dxi-column
          dataField="gstAmount"
         [caption]="(selected_vat_id == sessionData.VAT_ID && sessionData.VAT_ID == 2) ? ' VAT Amount' : ' GST Amount'" 
          dataType="number"
          [format]="{ type: 'fixedPoint', precision: 2 }"
          [width]="150"
        ></dxi-column>

        <dxo-summary>
          <dxi-total-item
            column="Amount"
            summaryType="sum"
            valueFormat="#,##0.00"
            displayFormat="Total: {0}"
            alignment="right"
          ></dxi-total-item>
          <dxi-total-item
            column="gstAmount"
            summaryType="sum"
            valueFormat="#,##0.00"
            displayFormat="Total: {0}"
            alignment="right"
          ></dxi-total-item>
        </dxo-summary>
      </dx-data-grid>

      <div
        style="
          margin-top: 15px;
          padding: 0 10px;
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          width: 100%;
        "
      >
        <!-- Left: Narration -->
        <dx-text-box
          label="Narration"
          [value]="creditFormData?.[0]?.NARRATION"
          labelMode="floating"
          [width]="400"
          [readOnly]="true"
        ></dx-text-box>

        <!-- Right: Net Amount + Approve checkbox -->
        <div
          style="
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
          "
        >
          <dx-text-box
            label="Net Amount"
            [value]="creditFormData?.[0]?.NET_AMOUNT"
            labelMode="floating"
            [width]="200"
            [readOnly]="true"
            [inputAttr]="{ style: 'text-align: right;' }"
          ></dx-text-box>

          <dx-check-box
            text="Approve"
            [value]="creditFormData?.[0]?.TRANS_STATUS === 5"
            [readOnly]="true"
          ></dx-check-box>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="form-popup-buttons-container">
  <div class="popup-footer">
    <dx-button
      text="Cancel"
      (onClick)="cancel()"
      stylingMode="outlined"
      type="normal"
    ></dx-button>
  </div>
</div>
